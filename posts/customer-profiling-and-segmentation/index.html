<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Customer Profiling & Segmentation with Python (Source code) - Chloevolution</title>
<link rel=canonical href=https://chloevolution.com/posts/customer-profiling-and-segmentation/><meta name=Description content="This article introduces how to do customer profiling and segmentation using Python."><meta property="og:url" content="https://chloevolution.com/posts/customer-profiling-and-segmentation/"><meta property="og:site_name" content="Chloevolution"><meta property="og:title" content="Customer Profiling & Segmentation with Python (Source code)"><meta property="og:description" content="This article introduces how to do customer profiling and segmentation using Python."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-07T11:49:14+08:00"><meta property="article:modified_time" content="2024-04-07T11:49:14+08:00"><meta property="article:tag" content="Python"><meta property="og:image" content="https://chloevolution.com/posts/customer-profiling-and-segmentation/feature-correlation.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://chloevolution.com/posts/customer-profiling-and-segmentation/feature-correlation.png"><meta name=twitter:title content="Customer Profiling & Segmentation with Python (Source code)"><meta name=twitter:description content="This article introduces how to do customer profiling and segmentation using Python."><meta name=application-name content="Chloevolution"><meta name=apple-mobile-web-app-title content="Chloevolution"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=prev href=https://chloevolution.com/posts/best-mind-mapping-software-for-mac/><link rel=next href=https://chloevolution.com/posts/how-to-read-a-zst-file-python/><link rel=stylesheet href=/css/style.min.cf6878db51c51b2d04ae155284a4403dbee8db33e16c066f954c95279c271fcd.css integrity="sha256-z2h421HFGy0ErhVShKRAPb7o2zPhbAZvlUyVJ5wnH80="><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><link rel=alternate hreflang=en href=https://chloevolution.com/posts/customer-profiling-and-segmentation/><link rel=alternate hreflang=zh-CN href=https://chloevolution.com/zh-cn/posts/customer-profiling-and-segmentation/><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Customer Profiling \u0026 Segmentation with Python (Source code)","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/chloevolution.com\/posts\/customer-profiling-and-segmentation\/"},"image":["https:\/\/chloevolution.com\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"Python","wordcount":5901,"url":"https:\/\/chloevolution.com\/posts\/customer-profiling-and-segmentation\/","datePublished":"2024-04-07T11:49:14+08:00","dateModified":"2024-04-07T11:49:14+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":{"@type":"ImageObject","url":"https:\/\/chloevolution.com\/images\/avatar.jpg","width":4032,"height":3024}},"author":{"@type":"Person","name":"Author"},"description":"This article introduces how to do customer profiling and segmentation using Python."}</script><style>body{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}</style></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Chloevolution><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span>Chloevolution</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about/>About </a><a class=menu-item href=https://github.com/chloeekk title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="menu-item language" title="Select Language"><i class="fa fa-globe" aria-hidden=true></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/posts/customer-profiling-and-segmentation/ selected>English</option><option value=/zh-cn/posts/customer-profiling-and-segmentation/>简体中文</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Chloevolution><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw' aria-hidden=true></i></span>Chloevolution</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title>About</a><a class=menu-item href=https://github.com/chloeekk title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class=menu-item title="Select Language"><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select onchange="location=this.value"><option value=/posts/customer-profiling-and-segmentation/ selected>English</option><option value=/zh-cn/posts/customer-profiling-and-segmentation/>简体中文</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Customer Profiling & Segmentation with Python (Source code)</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Author</a></span>&nbsp;<span class=post-category>included in <a href=/categories/python/><i class="far fa-folder fa-fw" aria-hidden=true></i>Python</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2024-04-07>2024-04-07</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;5901 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;28 minutes&nbsp;<span id=/posts/customer-profiling-and-segmentation/ class=leancloud_visitors data-flag-title="Customer Profiling & Segmentation with Python (Source code)">
<i class="far fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;views
</span>&nbsp;
<span id=busuanzi_container_value_page_pv><i class="far fa-eye fa-fw"></i>
<span id=busuanzi_value_page_pv></span>&nbsp;views</span></div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-data-preparation>1. Data Preparation</a><ul><li><a href=#modulenotfounderror-no-module-named-yellowbrick>ModuleNotFoundError: No module named ‘yellowbrick’</a></li></ul></li><li><a href=#2-data-cleaning>2. Data Cleaning</a><ul><li><a href=#valueerror-time-data-doesnt-match>ValueError: time data doesn’t match</a></li></ul></li><li><a href=#3-data-visualization>3. Data Visualization</a><ul><li><a href=#error-only-title-appears-no-picture>Error: Only title appears, no picture</a></li><li><a href=#how-to-use-pltsubplot_mosaic>How to use plt.subplot_mosaic</a></li></ul></li><li><a href=#4-data-processing>4. Data Processing</a></li><li><a href=#5-cluster-analysis>5. Cluster Analysis</a><ul><li><a href=#principle-of-elbow-method>Principle of &ldquo;Elbow method&rdquo;</a></li><li><a href=#why-does-sse-decrease-as-k-increases>Why does SSE decrease as k increases?</a></li></ul></li><li><a href=#6-customer-profiling-and-segmentation>6. Customer Profiling and Segmentation</a><ul><li><a href=#what-do-you-think-of-the-violin-diagram>What do you think of the violin diagram?</a></li><li><a href=#how-to-analyze-the-kernel-density-estimation-chart>How to analyze the kernel density estimation chart</a></li><li><a href=#how-to-analyze-a-scatter-plot>How to analyze a scatter plot?</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>The sample data and analysis code used in this article are from Kaggle. However, because the actual running results are different from <a href=https://www.kaggle.com/code/mfaaris/customer-segmentation-insights-profiling target=_blank rel="noopener noreffer">original author</a>, there are slight differences in the analysis part.</p><p>The specific analysis process includes:</p><ol><li>Data Preparation</li><li>Data Cleaning</li><li>Data Visualization</li><li>Data Processing</li><li>Cluster Analysis</li><li>Customer Profiling and Segmentation</li></ol><h2 id=1-data-preparation>1. Data Preparation</h2><p>Use the KMeans clustering algorithm to divide the data into K clusters:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>seaborn</span> <span class=k>as</span> <span class=nn>sns</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pandas</span> <span class=kn>import</span> <span class=n>get_dummies</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.cluster</span> <span class=kn>import</span> <span class=n>KMeans</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.preprocessing</span> <span class=kn>import</span> <span class=n>StandardScaler</span><span class=p>,</span> <span class=n>LabelEncoder</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>yellowbrick.cluster</span> <span class=kn>import</span> <span class=n>KElbowVisualizer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>warnings</span>
</span></span><span class=line><span class=cl><span class=n>warnings</span><span class=o>.</span><span class=n>filterwarnings</span><span class=p>(</span><span class=s1>&#39;ignore&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=modulenotfounderror-no-module-named-yellowbrick>ModuleNotFoundError: No module named ‘yellowbrick’</h3><p><img src=/posts/customer-profiling-and-segmentation/yellowbrick-error_hu_924bee1d40c93ae6.png alt=yellowbrick-error width=1290 height=143></p><p>The reason for this error is that the Yellowbrick library is not installed locally.</p><p>Yellowbrick is a machine learning visualization library that mainly relies on the sklearn machine learning library and can provide visualization of a variety of machine learning algorithms.</p><p>Yellowbrick has two main dependencies: scikit-learn and matplotlib. Yellowbrick is a Python 3 package that works with version 3.4 or higher.</p><p>installation method:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pip install yellowbrick
</span></span></code></pre></td></tr></table></div></div><p>Check the basic situation of the data, there are 29 columns:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#sep is the delimiter, character type, and the default value is &#39;,&#39;. &#39;\t&#39; is tab separated</span>
</span></span><span class=line><span class=cl><span class=c1>#If there is a space before the data, or there is a space between the delimiter and the data, if skipinitialspace is specified as True, this space will be skipped before reading the data. If the value is False, spaces will not be skipped, but spaces will be read as part of the data. The default value of skipinitialspace is False</span>
</span></span><span class=line><span class=cl><span class=n>df_dataset</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s1>&#39;marketing_campaign.csv&#39;</span><span class=p>,</span> <span class=n>sep</span><span class=o>=</span><span class=s1>&#39;</span><span class=se>\t</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>skipinitialspace</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Return the first n rows of the object based on the position, the default is the first 5 rows</span>
</span></span><span class=line><span class=cl><span class=n>df_dataset</span><span class=o>.</span><span class=n>head</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/dataset-head_hu_e73c43698e416d4b.png alt=dataset-head width=1976 height=156></p><p>Check the numerical type and null value of each column:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#info() function is used to print a brief summary of the DataFrame, displaying information about the DataFrame, including the data type of the index, the data type of the column, the number of non-null values, and memory usage.</span>
</span></span><span class=line><span class=cl><span class=n>df_dataset</span><span class=o>.</span><span class=n>info</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/dataset-info_hu_83c103a3be650862.png alt=dataset-info width=798 height=420></p><h2 id=2-data-cleaning>2. Data Cleaning</h2><p>It is known that the type of customer registration time (Dt_Customer) is Object. In order to facilitate subsequent splitting into year, month, and day, it needs to be converted into date and time format.</p><p>At the same time, use <code>date()</code> to view the time span of the data. It can be seen that the customer registration time in the data set is 2012-2014:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#to_datetime() converts parameters into date and time format</span>
</span></span><span class=line><span class=cl><span class=c1>#The original format of Dt_Customer is Object, not the time format and needs to be converted.</span>
</span></span><span class=line><span class=cl><span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Dt_Customer&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>to_datetime</span><span class=p>(</span><span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Dt_Customer&#39;</span><span class=p>],</span> <span class=n>dayfirst</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;The oldest record on customer&#39;s enrollment:&#34;</span><span class=p>,</span> <span class=nb>min</span><span class=p>(</span><span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Dt_Customer&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>date</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;The newest record on customer&#39;s enrollment:&#34;</span><span class=p>,</span> <span class=nb>max</span><span class=p>(</span><span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Dt_Customer&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>date</span><span class=p>())</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/dataset-record-span_hu_57394f5e1e089c55.png alt=dataset-record-span width=1558 height=102></p><h3 id=valueerror-time-data-doesnt-match>ValueError: time data doesn’t match</h3><p>The default date parsing order of to_datetime() is month, day, and year, and the date format in the data set is day, month, and year, so the value of dayfirst needs to be specified:</p><p><img src=/posts/customer-profiling-and-segmentation/time-data-error_hu_4feabf4f670605b0.png alt=time-data-error width=1976 height=78></p><p><img src=/posts/customer-profiling-and-segmentation/dayfirst-set-true_hu_535c071e1d3688db.png alt=dayfirst-set-true width=1556 height=63></p><p>Optimize some attributes to facilitate subsequent analysis:</p><ul><li>Age: The most recent time recorded by the customer is 2014. Use this as the anchor point and subtract the customer’s date of birth.</li><li>Education: reduced to 3 categories: Graduate, Postgraduate, Undergraduate</li><li>Marriage status (Living_With): reduced to 2 categories: Partner, Alone</li><li>Number of children (Total_Children): new attribute, combining &ldquo;Kidhome&rdquo; and &ldquo;Teenhome&rdquo;, indicating the total number of children in the customer&rsquo;s home (children + teenagers)</li><li>Customer registration time (Dt_Customer): split into days, days of the week, months, and years</li><li>Whether you are a parent (Is_Parent): a new attribute that indicates the customer’s parenting status
-Total_Spent: the customer’s total spending</li><li>The remaining characteristic attributes remain unchanged</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Age&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>2014</span> <span class=o>-</span> <span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Year_Birth&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Education&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Education&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>replace</span><span class=p>({</span><span class=s1>&#39;Graduation&#39;</span><span class=p>:</span><span class=s1>&#39;Graduate&#39;</span><span class=p>,</span> <span class=s1>&#39;PhD&#39;</span><span class=p>:</span><span class=s1>&#39;Postgraduate&#39;</span><span class=p>,</span> <span class=s1>&#39;Master&#39;</span><span class=p>:</span><span class=s1>&#39;Postgraduate&#39;</span><span class=p>,</span> <span class=s1>&#39;2n Cycle&#39;</span><span class=p>:</span><span class=s1>&#39;Postgraduate&#39;</span><span class=p>,</span> <span class=s1>&#39;Basic&#39;</span><span class=p>:</span><span class=s1>&#39;Undergraduate&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Living_With&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Marital_Status&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>replace</span><span class=p>({</span><span class=s1>&#39;Married&#39;</span><span class=p>:</span><span class=s1>&#39;Partner&#39;</span><span class=p>,</span> <span class=s1>&#39;Together&#39;</span><span class=p>:</span><span class=s1>&#39;Partner&#39;</span><span class=p>,</span> <span class=s1>&#39;Single&#39;</span><span class=p>:</span><span class=s1>&#39;Alone&#39;</span><span class=p>,</span> <span class=s1>&#39;Divorced&#39;</span><span class=p>:</span><span class=s1>&#39;Alone&#39;</span><span class=p>,</span> <span class=s1>&#39;Widow&#39;</span><span class=p>:</span><span class=s1>&#39;Alone&#39;</span><span class=p>,</span> <span class=s1>&#39;Absurd&#39;</span><span class=p>:</span><span class=s1>&#39;Alone&#39;</span><span class=p>,</span> <span class=s1>&#39;YOLO&#39;</span><span class=p>:</span><span class=s1>&#39;Alone&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Total_Children&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Kidhome&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Teenhome&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Split the customer registration time into specific days, months, years and corresponding days of the week</span>
</span></span><span class=line><span class=cl><span class=c1>#Lambda function is also called an anonymous function, that is, a function without a specific name. The format is: lambda parameter: operation (parameter)</span>
</span></span><span class=line><span class=cl><span class=c1>#With the colon as the dividing line, the left side is the input variable, and the right side is the operation performed on the variable.</span>
</span></span><span class=line><span class=cl><span class=c1>#Using the combination of lambda and apply function, you can operate on a row or column of DataFrame</span>
</span></span><span class=line><span class=cl><span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Day&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Dt_Customer&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>day</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Dayofweek&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Dt_Customer&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>day_name</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Month&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Dt_Customer&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>month</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Year&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Dt_Customer&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>year</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#If there is a child, the value is 1, otherwise it is 0</span>
</span></span><span class=line><span class=cl><span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Is_Parent&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Total_Children&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=mi>1</span> <span class=k>if</span> <span class=n>x</span> <span class=o>!=</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;Total_Spent&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;MntWines&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;MntFruits&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;MntMeatProducts&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;MntFishProducts&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;MntSweetProducts&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=n>df_dataset</span><span class=p>[</span><span class=s1>&#39;MntGoldProds&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Simplify attribute names</span>
</span></span><span class=line><span class=cl><span class=c1>#The role of the inplace parameter: when it is True, no new object is created, and the original object is modified directly; when it is False, the data is modified, and a new object is created and returned to carry the modification results.</span>
</span></span><span class=line><span class=cl><span class=n>df_dataset</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;MntWines&#39;</span><span class=p>:</span><span class=s1>&#39;Wines&#39;</span><span class=p>,</span> <span class=s1>&#39;MntFruits&#39;</span><span class=p>:</span><span class=s1>&#39;Fruits&#39;</span><span class=p>,</span> <span class=s1>&#39;MntMeatProducts&#39;</span><span class=p>:</span><span class=s1>&#39;Meats&#39;</span><span class=p>,</span> <span class=s1>&#39;MntFishProducts&#39;</span><span class=p>:</span><span class=s1>&#39;Fish&#39;</span><span class=p>,</span> <span class=s1>&#39;MntSweetProducts&#39;</span><span class=p>:</span><span class=s1>&#39;Sweets&#39;</span><span class=p>,</span> <span class=s1>&#39;MntGoldProds&#39;</span><span class=p>:</span><span class=s1>&#39;Golds&#39;</span><span class=p>},</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_dataset</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;NumWebPurchases&#39;</span><span class=p>:</span><span class=s1>&#39;Web&#39;</span><span class=p>,</span> <span class=s1>&#39;NumCatalogPurchases&#39;</span><span class=p>:</span><span class=s1>&#39;Catalog&#39;</span><span class=p>,</span> <span class=s1>&#39;NumStorePurchases&#39;</span><span class=p>:</span><span class=s1>&#39;Store&#39;</span><span class=p>},</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#dropna() can find the null value of DataFrame type data, delete the row/column where the null value is located, and return the new DataFrame as the return value</span>
</span></span><span class=line><span class=cl><span class=c1>#drop() can delete a row or column in the table without changing the data in the original DataFrame, but returns another DataFrame to store the deleted data.</span>
</span></span><span class=line><span class=cl><span class=c1>#drop() deletes rows by default. If you want to delete columns, you need to add &#39;axis = 1&#39;</span>
</span></span><span class=line><span class=cl><span class=n>df_dataset</span><span class=o>.</span><span class=n>dropna</span><span class=p>(</span><span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_dataset</span><span class=o>.</span><span class=n>drop</span><span class=p>([</span><span class=s1>&#39;ID&#39;</span><span class=p>,</span> <span class=s1>&#39;Dt_Customer&#39;</span><span class=p>,</span> <span class=s1>&#39;Year_Birth&#39;</span><span class=p>,</span> <span class=s1>&#39;Marital_Status&#39;</span><span class=p>,</span> <span class=s1>&#39;Z_CostContact&#39;</span><span class=p>,</span> <span class=s1>&#39;Z_Revenue&#39;</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#copy() creates a new list containing the same elements</span>
</span></span><span class=line><span class=cl><span class=n>df</span> <span class=o>=</span> <span class=n>df_dataset</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>Sort by customer&rsquo;s income and age in ascending order, read the last 5 rows to confirm whether there are any outliers</p><p>Delete outliers: age greater than or equal to 80, income too high</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#sort_values() can sort the Dataframe&#39;s data set according to the data in a certain field. The default is ascending order.</span>
</span></span><span class=line><span class=cl><span class=c1>#tail() reads the last specific line of the file</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Income:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Income&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sort_values</span><span class=p>()</span><span class=o>.</span><span class=n>tail</span><span class=p>(</span><span class=mi>5</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>Age:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Age&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>sort_values</span><span class=p>()</span><span class=o>.</span><span class=n>tail</span><span class=p>(</span><span class=mi>5</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Remove outliers</span>
</span></span><span class=line><span class=cl><span class=n>df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=mi>2233</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Age&#39;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>80</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/income-age-sort_hu_55cdcb7e134ef252.png alt=income-age-sort width=428 height=169></p><h2 id=3-data-visualization>3. Data Visualization</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#Set chart color system</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>color_palette</span><span class=p>(</span><span class=s1>&#39;Blues&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Draw a scatter matrix diagram to initially observe the correlation between several characteristics such as &ldquo;age&rdquo;, &ldquo;income&rdquo;, &ldquo;total expenditure&rdquo;, &ldquo;consumption frequency&rdquo;, and &ldquo;whether you are a parent&rdquo;:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;Age&#39;</span><span class=p>,</span> <span class=s1>&#39;Income&#39;</span><span class=p>,</span> <span class=s1>&#39;Total_Spent&#39;</span><span class=p>,</span> <span class=s1>&#39;Recency&#39;</span><span class=p>,</span> <span class=s1>&#39;Is_Parent&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#pairplot is a scatter matrix plot, used to show the relationship between two features. On the diagonal is the histogram (distribution diagram) of each attribute, and on the off-diagonal is the correlation diagram between two different attributes.</span>
</span></span><span class=line><span class=cl><span class=c1>#hue performs color classification for a certain field, and palette controls the hue.</span>
</span></span><span class=line><span class=cl><span class=c1>#suptitle() is used to add a centered title to the figure, y is the y position of the text in the figure coordinates</span>
</span></span><span class=line><span class=cl><span class=n>plot</span> <span class=o>=</span> <span class=n>sns</span><span class=o>.</span><span class=n>pairplot</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>data</span><span class=p>],</span> <span class=n>hue</span><span class=o>=</span><span class=s1>&#39;Is_Parent&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plot</span><span class=o>.</span><span class=n>fig</span><span class=o>.</span><span class=n>suptitle</span><span class=p>(</span><span class=s1>&#39;Feature Relationship&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=mf>1.05</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>16</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/feature-relationship-pairplot_hu_9fdb7a771b8efd72.png alt=feature-relationship-pairplot width=1076 height=420></p><p>As can be seen from the chart:</p><ul><li>The income, consumption amount, and consumption frequency of non-parents are significantly higher than those of parents</li><li>The higher the income, the more willing people are to spend money</li></ul><h3 id=error-only-title-appears-no-picture>Error: Only title appears, no picture</h3><p>If you use Jupyter Notebook, you need to add it at the beginning of the code
<code>%matplotlib inline</code></p><p>The function is to display images in Notebook without explicitly calling plt.show(). For specific principles, please refer to [Stackoverflow](<a href=https://stackoverflow.com/questions/21176731/automatically-run-matplotlib-inline-in target=_blank rel="noopener noreffer">https://stackoverflow.com/questions/21176731/automatically-run-matplotlib-inline-in</a> -ipython-notebook)</p><p><img src=/posts/customer-profiling-and-segmentation/matplotlib-inline_hu_6f511b9a5f20ca99.png alt=matplotlib-inline width=768 height=118></p><p>Observe the time distribution of customers registering as members through a bar chart:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#Create a 2*2 grid on the figure</span>
</span></span><span class=line><span class=cl><span class=c1>#flatten() reduces the dimension of the array and returns a copy. Modifications to the copy will not affect the original matrix.</span>
</span></span><span class=line><span class=cl><span class=c1>#axes.flatten() expands the subgraph and assigns it to axes, then axes[0] is the first subgraph, axes[1] is the second subgraph, and so on.</span>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>axes</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>15</span><span class=p>,</span><span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>axes</span> <span class=o>=</span> <span class=n>axes</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=o>.</span><span class=n>suptitle</span><span class=p>(</span><span class=s2>&#34;When Did the Customer Enrolled To be a Member&#34;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#sns.countplot is used to draw frequency bar charts of category features</span>
</span></span><span class=line><span class=cl><span class=c1>#order sorts the fields of x or y, and the sorting method is a list</span>
</span></span><span class=line><span class=cl><span class=c1>#ax is used to specify the coordinate system</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>countplot</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Dayofweek&#39;</span><span class=p>],</span> <span class=n>order</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;Monday&#39;</span><span class=p>,</span> <span class=s1>&#39;Tuesday&#39;</span><span class=p>,</span> <span class=s1>&#39;Wednesday&#39;</span><span class=p>,</span> <span class=s1>&#39;Thursday&#39;</span><span class=p>,</span> <span class=s1>&#39;Friday&#39;</span><span class=p>,</span><span class=s1>&#39;Saturday&#39;</span><span class=p>,</span> <span class=s1>&#39;Sunday&#39;</span><span class=p>],</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>countplot</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Day&#39;</span><span class=p>],</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>countplot</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Month&#39;</span><span class=p>],</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>countplot</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Year&#39;</span><span class=p>],</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/register-time-bar-chart_hu_4cde27a9d3a9915d.png alt=register-time-bar-chart width=1235 height=302></p><p>As can be seen from the chart:</p><ul><li>Most consumers register as members on Mondays and Wednesdays</li><li>Significantly more registrations on the 12th day of each month</li><li>August has the largest number of registrations, followed by May, October, and March, all with more than 200 people</li><li>2013 had the largest number of registrations (but there is a problem of missing data, this data set does not include data for the first half of 2012 and the second half of 2014)</li></ul><p>Divide &ldquo;age&rdquo; into different intervals, with a span of 10:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#pd.cut divides a set of data into discrete intervals. By default, the left side is the open interval and the right side is the closed interval.</span>
</span></span><span class=line><span class=cl><span class=n>group</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>cut</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Age&#39;</span><span class=p>],</span> <span class=p>[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>40</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>70</span><span class=p>,</span> <span class=mi>80</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#value_counts()用于查看表格中有多少个不同值</span>
</span></span><span class=line><span class=cl><span class=n>group</span><span class=o>.</span><span class=n>value_counts</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/age-span_hu_746125a02abda66c.png alt=age-span width=360 height=103></p><p>Copy a new data table and replace &ldquo;age&rdquo; with the processed interval data:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df2</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Replace the Age column with the split data</span>
</span></span><span class=line><span class=cl><span class=n>df2</span><span class=p>[</span><span class=s1>&#39;Age&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>group</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Category customer spending according to age, and sum and average respectively</span>
</span></span><span class=line><span class=cl><span class=n>sum_group</span> <span class=o>=</span> <span class=n>df2</span><span class=p>[[</span><span class=s1>&#39;Total_Spent&#39;</span><span class=p>,</span> <span class=s1>&#39;Age&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;Age&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>mean_group</span> <span class=o>=</span> <span class=n>df2</span><span class=p>[[</span><span class=s1>&#39;Total_Spent&#39;</span><span class=p>,</span> <span class=s1>&#39;Age&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;Age&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>axes</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>14</span><span class=p>,</span><span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>axes</span> <span class=o>=</span> <span class=n>axes</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#barplot draws a histogram, ci is the size of the confidence interval, and orient is the drawing direction.</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=n>sum_group</span><span class=p>[</span><span class=s1>&#39;Total_Spent&#39;</span><span class=p>],</span> <span class=n>y</span><span class=o>=</span><span class=n>sum_group</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>orient</span><span class=o>=</span><span class=s1>&#39;h&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Total Spent on Products</span><span class=se>\n</span><span class=s1>by Age Groups&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#enumerate() Combines a traversable data object into an index sequence, listing both the data subscript and the data</span>
</span></span><span class=line><span class=cl><span class=c1>#plt.text() is used to set text descriptions</span>
</span></span><span class=line><span class=cl><span class=c1>#&#39;$ {}&#39;.format(v) adds currency symbols to all amounts</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span><span class=p>,</span><span class=n>v</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>sum_group</span><span class=p>[</span><span class=s1>&#39;Total_Spent&#39;</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>or</span> <span class=n>i</span> <span class=o>==</span><span class=mi>6</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=n>v</span><span class=o>+</span><span class=mi>30000</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=s1>&#39;$ </span><span class=si>{}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>v</span><span class=p>),</span> <span class=n>horizontalalignment</span><span class=o>=</span><span class=s1>&#39;center&#39;</span><span class=p>,</span> <span class=n>verticalalignment</span><span class=o>=</span><span class=s1>&#39;center&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;black&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>12</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=n>v</span><span class=o>-</span><span class=mi>40000</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=s1>&#39;$ </span><span class=si>{}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>v</span><span class=p>),</span> <span class=n>horizontalalignment</span><span class=o>=</span><span class=s1>&#39;center&#39;</span><span class=p>,</span> <span class=n>verticalalignment</span><span class=o>=</span><span class=s1>&#39;center&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;white&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>12</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=n>mean_group</span><span class=p>[</span><span class=s1>&#39;Total_Spent&#39;</span><span class=p>],</span> <span class=n>y</span><span class=o>=</span><span class=n>mean_group</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>orient</span><span class=o>=</span><span class=s1>&#39;h&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Average Spent on Products</span><span class=se>\n</span><span class=s1>by Age Groups&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#round(v,2) retains two decimal places of floating point numbers</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span><span class=p>,</span><span class=n>v</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>mean_group</span><span class=p>[</span><span class=s1>&#39;Total_Spent&#39;</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>    <span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=n>v</span><span class=o>-</span><span class=mi>130</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=s1>&#39;$ </span><span class=si>{}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>round</span><span class=p>(</span><span class=n>v</span><span class=p>,</span><span class=mi>2</span><span class=p>)),</span> <span class=n>horizontalalignment</span><span class=o>=</span><span class=s1>&#39;center&#39;</span><span class=p>,</span> <span class=n>verticalalignment</span><span class=o>=</span><span class=s1>&#39;center&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;white&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>12</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/spent-age-group_hu_e07634a668204211.png alt=spent-age-group width=1181 height=290></p><p>As can be seen from the chart:</p><ul><li>Consumption distribution is obviously polarized. The total number of people in the age range at both ends does not exceed 20, resulting in a significant gap in total consumption amount</li><li>The average consumption amount of people over 70 years old is the highest, exceeding US$1,000, which is equivalent to twice the average consumption amount of people aged 30-40 years old</li></ul><p>Observe the consumption preferences of different age groups for different products and the contribution of each category to the company&rsquo;s revenue:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>axd</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplot_mosaic</span><span class=p>([[</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>],[</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>],</span> <span class=p>[</span><span class=mi>6</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>],</span> <span class=p>[</span><span class=mi>6</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>],</span> <span class=p>[</span><span class=mi>6</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>]],</span>
</span></span><span class=line><span class=cl>                              <span class=n>constrained_layout</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>18</span><span class=p>,</span><span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=o>.</span><span class=n>suptitle</span><span class=p>(</span><span class=s2>&#34;Customer&#39;s Average Spent on Products</span><span class=se>\n</span><span class=s2>by Age Groups&#34;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Draw a bar chart and set the corresponding chart namesns.barplot(data=df, x=group, y=&#39;Wines&#39;, palette=&#39;Blues&#39;, ci=None, ax=axd[0])</span>
</span></span><span class=line><span class=cl><span class=n>axd</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Wines&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=n>group</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Fruits&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axd</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axd</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Fruits&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=n>group</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Meats&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axd</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axd</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Meats&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=n>group</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Fish&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axd</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axd</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Fish&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=n>group</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Sweets&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axd</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axd</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Sweets&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=n>group</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Golds&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axd</span><span class=p>[</span><span class=mi>5</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axd</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Gold&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Draw a pie chart, sum each product category and then sort it in ascending order</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>df</span><span class=p>[[</span><span class=s1>&#39;Wines&#39;</span><span class=p>,</span> <span class=s1>&#39;Fruits&#39;</span><span class=p>,</span> <span class=s1>&#39;Meats&#39;</span><span class=p>,</span> <span class=s1>&#39;Fish&#39;</span><span class=p>,</span> <span class=s1>&#39;Sweets&#39;</span><span class=p>,</span> <span class=s1>&#39;Golds&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=o>.</span><span class=n>sort_values</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Set the color of the pie chart</span>
</span></span><span class=line><span class=cl><span class=n>palette</span> <span class=o>=</span> <span class=n>sns</span><span class=o>.</span><span class=n>color_palette</span><span class=p>(</span><span class=s1>&#39;Blues&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#wedges is a list containing fan objects, texts is a list containing text label objects, and autotexts is a list containing automatically generated text label objects.</span>
</span></span><span class=line><span class=cl><span class=c1>#autopct sets the display format of each sector percentage in the pie chart. &#39;%.2f%%&#39; is a percentage with two decimal places. textprops is a dictionary type, used to specify the attributes of text labels, such as font size, font color, etc.</span>
</span></span><span class=line><span class=cl><span class=n>wedges</span><span class=p>,</span> <span class=n>texts</span><span class=p>,</span> <span class=n>autotexts</span> <span class=o>=</span> <span class=n>axd</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span><span class=o>.</span><span class=n>pie</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=n>data</span><span class=p>,</span> <span class=n>labels</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> <span class=n>autopct</span><span class=o>=</span><span class=s1>&#39;</span><span class=si>%.2f%%</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>colors</span><span class=o>=</span><span class=n>palette</span><span class=p>,</span> <span class=n>textprops</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>fontsize</span><span class=o>=</span><span class=mi>12</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=n>axd</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n\n</span><span class=s2>Percentage of Company&#39;s Profit</span><span class=se>\n</span><span class=s2>from Products&#34;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>20</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=mf>1.2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Set the color and font of the text label object</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>autotext</span> <span class=ow>in</span> <span class=n>autotexts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>autotext</span><span class=o>.</span><span class=n>set_color</span><span class=p>(</span><span class=s1>&#39;white&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>autotext</span><span class=o>.</span><span class=n>set_weight</span><span class=p>(</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=c1>#Set the label text description on the right side of the pie chart</span>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=c1>#enumerate function provides a counter i</span>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=c1>#zip function packs the index of the data and the corresponding value into a tuple (name, value) for each iteration in the loop.</span>
</span></span><span class=line><span class=cl><span class=c1>#The x coordinate is fixed at 2.3, while the y coordinate starts from 0.5 and moves downward by 0.2 each time (calculated from 0.5-0.2*i) to arrange the text vertically</span>
</span></span><span class=line><span class=cl><span class=c1>#r&#34;$\bf{&#34; + name + &#34;}$&#34; displays name in bold, &#34;\t:&#34; inserts a tab character and colon as delimiters, &#34;\$&#34; + str(value) displays a dollar sign and value converted to string</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=nb>zip</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> <span class=n>data</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>axd</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=mf>2.3</span><span class=p>,</span> <span class=mf>0.5</span><span class=o>-</span><span class=mf>0.2</span><span class=o>*</span><span class=n>i</span><span class=p>,</span> <span class=sa>r</span><span class=s2>&#34;$\bf{&#34;</span> <span class=o>+</span> <span class=n>name</span> <span class=o>+</span> <span class=s2>&#34;}$&#34;</span> <span class=o>+</span> <span class=s2>&#34;</span><span class=se>\t</span><span class=s2>:&#34;</span> <span class=o>+</span> <span class=s2>&#34; \$&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>value</span><span class=p>),</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>14</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=c1>#Hide the axis of the subgraph with key 7 in the axd dictionary</span>
</span></span><span class=line><span class=cl><span class=n>axd</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span><span class=o>.</span><span class=n>axis</span><span class=p>(</span><span class=s1>&#39;off&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/products-spent-age-group_hu_b2137b95e53cb43c.png alt=products-spent-age-group width=1811 height=404></p><p>It can be seen from the chart:</p><ul><li>Except for fruits, candies, and gold, in other categories, people over 70 years old have the highest spending amount. Among them, their average consumption amount on alcoholic products exceeds 600 US dollars.</li><li>Liquor is the company&rsquo;s highest-selling product, followed by meat and gold. Liquor contributed US$675k in sales in 3 years, accounting for 50.27% of the company&rsquo;s total revenue</li></ul><h3 id=how-to-use-pltsubplot_mosaic>How to use plt.subplot_mosaic</h3><p>plt.subplot_mosaic can be used to create multiple different subplots at the same time, using a list to represent the orientation of axes, returning a figure and multiple axes</p><p>Parameters [[0,1,2],[3,4,5], [6,6,7], [6,6,7], [6,6,7]]: This parameter defines the subgraph layout. Here, we provide a list of lists (or a matrix), where each sublist represents a row in the graph, and each element in the list represents a subgraph position in that row. By repeating numbers, we indicate that certain subplots span multiple rows or columns. In this example, the number 6 appears in three rows and two columns, indicating that there is a subgraph spanning these positions.</p><p>According to this code, the final layout will have 8 subgraphs, and the layout is as follows:</p><p>There are three subgraphs in the first row, identified as 0, 1, and 2 respectively.
The second row also has three sub-pictures, labeled 3, 4, and 5 respectively.
Beginning on the third row, there is a larger subfigure labeled 6, which spans the third to fifth rows and takes up two columns of space. Next to it is a smaller subplot identified as 7</p><p>Observe the shopping channels preferred by people of different age groups, as well as the company’s overall order sources:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>axd</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplot_mosaic</span><span class=p>([[</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>],</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>],</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>]],</span>
</span></span><span class=line><span class=cl>                               <span class=n>constrained_layout</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>18</span><span class=p>,</span><span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=o>.</span><span class=n>suptitle</span><span class=p>(</span><span class=s2>&#34;Average Number of Purchases Made</span><span class=se>\n</span><span class=s2>Through Different Methods by Age Groups&#34;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Specify the range of the y-axis from 0 to 8</span>
</span></span><span class=line><span class=cl><span class=c1>#plt.setp() sets the range of the y-axis in the subgraph</span>
</span></span><span class=line><span class=cl><span class=n>custom_ylim</span> <span class=o>=</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>setp</span><span class=p>(</span><span class=n>axd</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>ylim</span><span class=o>=</span><span class=n>custom_ylim</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>setp</span><span class=p>(</span><span class=n>axd</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>ylim</span><span class=o>=</span><span class=n>custom_ylim</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#After classifying according to &#34;Purchase methods&#34;, draw a bar chart</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=n>group</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Web&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axd</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axd</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Web&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=n>group</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Catalog&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axd</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axd</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Catalog&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=n>group</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Store&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axd</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axd</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Store&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#According to the &#34;purchase methods&#34;, calculate the sum and draw a pie chart</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>df</span><span class=p>[[</span><span class=s1>&#39;Web&#39;</span><span class=p>,</span> <span class=s1>&#39;Catalog&#39;</span><span class=p>,</span> <span class=s1>&#39;Store&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=o>.</span><span class=n>sort_values</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Set pie chart color and details</span>
</span></span><span class=line><span class=cl><span class=n>palette</span> <span class=o>=</span> <span class=n>sns</span><span class=o>.</span><span class=n>color_palette</span><span class=p>(</span><span class=s1>&#39;Blues&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>wedges</span><span class=p>,</span> <span class=n>texts</span><span class=p>,</span> <span class=n>autotexts</span> <span class=o>=</span> <span class=n>axd</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>pie</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=n>data</span><span class=p>,</span> <span class=n>labels</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> <span class=n>autopct</span><span class=o>=</span><span class=s1>&#39;</span><span class=si>%.2f%%</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>colors</span><span class=o>=</span><span class=n>palette</span><span class=p>,</span> <span class=n>textprops</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>fontsize</span><span class=o>=</span><span class=mi>12</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=n>axd</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n\n</span><span class=s1>Percentage of Purchases Made</span><span class=se>\n</span><span class=s1>Through Different Methods&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>20</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=mf>1.35</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>autotext</span> <span class=ow>in</span> <span class=n>autotexts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>autotext</span><span class=o>.</span><span class=n>set_color</span><span class=p>(</span><span class=s1>&#39;white&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>autotext</span><span class=o>.</span><span class=n>set_weight</span><span class=p>(</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=c1>#Set the position and display form of pie chart data labels</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=nb>zip</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> <span class=n>data</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>axd</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=mf>2.3</span><span class=p>,</span> <span class=mf>0.3</span><span class=o>-</span><span class=mf>0.2</span><span class=o>*</span><span class=n>i</span><span class=p>,</span> <span class=sa>r</span><span class=s2>&#34;$\bf{&#34;</span> <span class=o>+</span> <span class=n>name</span> <span class=o>+</span> <span class=s2>&#34;}$&#34;</span> <span class=o>+</span> <span class=s2>&#34;</span><span class=se>\t</span><span class=s2>:&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>value</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34; times&#34;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>14</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Hide unused images</span>
</span></span><span class=line><span class=cl><span class=n>axd</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>.</span><span class=n>axis</span><span class=p>(</span><span class=s1>&#39;off&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/purchase-methods-age-group_hu_2ad2421f755b0de.png alt=purchase-methods-age-group width=1811 height=324></p><p>It can be seen from the figure:</p><ul><li>Among the three different purchase channels, the consumption amount of people over 70 years old is the highest, although there are only 8 people in this group. Once again, it reflects that their consumption amount is significantly higher than that of other age groups.</li><li>Nearly half of sales come directly from stores, accounting for 46.2% of total purchases</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#Change the column name from &#39;Response&#39; to &#39;AcceptedCmp6&#39; to calculate the campaign accepted by the customer</span>
</span></span><span class=line><span class=cl><span class=c1>#inplace=True parameter ensures that changes are made directly on the original DataFrame rather than returning a new DataFrame</span>
</span></span><span class=line><span class=cl><span class=n>df</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;Response&#39;</span><span class=p>:</span><span class=s1>&#39;AcceptedCmp6&#39;</span><span class=p>},</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>9</span><span class=p>,</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s1>&#39;Percentage of Customer Who Accepted the nth Offer&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#df.sum() calculates the sum of all columns</span>
</span></span><span class=line><span class=cl><span class=c1>#len(df) returns the number of rows in the DataFrame df, which actually calculates the sum of each selected column as a percentage of all rows in the DataFrame</span>
</span></span><span class=line><span class=cl><span class=n>percent</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>sum</span><span class=p>()[[</span><span class=s1>&#39;AcceptedCmp1&#39;</span><span class=p>,</span> <span class=s1>&#39;AcceptedCmp2&#39;</span><span class=p>,</span> <span class=s1>&#39;AcceptedCmp3&#39;</span><span class=p>,</span> <span class=s1>&#39;AcceptedCmp4&#39;</span><span class=p>,</span> <span class=s1>&#39;AcceptedCmp5&#39;</span><span class=p>,</span> <span class=s1>&#39;AcceptedCmp6&#39;</span><span class=p>]]</span><span class=o>*</span><span class=mi>100</span><span class=o>/</span><span class=nb>len</span><span class=p>(</span><span class=n>df</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Plot percent data through bar graphs and line graphs respectively</span>
</span></span><span class=line><span class=cl><span class=c1>#Marked points are added via the style=&#39;o-&#39; parameter, which means that the data points are marked with circles (&#39;o&#39;) and connected by straight lines (&#39;-&#39;)</span>
</span></span><span class=line><span class=cl><span class=n>ax</span> <span class=o>=</span> <span class=n>percent</span><span class=o>.</span><span class=n>plot</span><span class=o>.</span><span class=n>bar</span><span class=p>(</span><span class=n>color</span><span class=o>=</span><span class=s1>&#39;#6495ED&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>percent</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>style</span><span class=o>=</span><span class=s1>&#39;o-&#39;</span><span class=p>,</span> <span class=n>colormap</span><span class=o>=</span><span class=s1>&#39;copper&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>setp</span><span class=p>(</span><span class=n>ax</span><span class=p>,</span> <span class=n>ylim</span><span class=o>=</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>18</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#x coordinate is the index i of the data point, aligning the text with the corresponding data point</span>
</span></span><span class=line><span class=cl><span class=c1>#y coordinate is the value v of the data point plus 1.2. This is done to place the text a certain distance above the data point and avoid overlapping the text with the data point or other elements of the chart.</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span><span class=p>,</span><span class=n>v</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>percent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>v</span><span class=o>+</span><span class=mf>1.2</span><span class=p>,</span> <span class=s1>&#39;</span><span class=si>{:.2f}</span><span class=s1>%&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>v</span><span class=p>),</span> <span class=n>horizontalalignment</span><span class=o>=</span><span class=s1>&#39;center&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;Black&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/customer-accepted-offer_hu_473a460deb607dab.png alt=customer-accepted-offer width=742 height=149></p><p>It can be seen from the figure:</p><ul><li>Only 6.42% of people were willing to accept the first campaign, and even plummeted to 1.36% for the second time.</li><li>The sixth campaign clearly attracted a large number of customers, with an acceptance rate as high as 15.05%</li></ul><p>Observe the distribution of people who use discounts for shopping and the impact of the factor &ldquo;whether they have become a parent&rdquo;:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>9</span><span class=p>,</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s1>&#39;Average Number of Purchases Made with a Discount</span><span class=se>\n</span><span class=s1>by Age Groups&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Observe the use of discounts for shopping according to &#34;whether they have become a parent&#34;</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=n>group</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;NumDealsPurchases&#39;</span><span class=p>,</span> <span class=n>hue</span><span class=o>=</span><span class=s1>&#39;Is_Parent&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/discount-age-group_hu_2588d9499f1828f6.png alt=discount-age-group width=766 height=166></p><p>It can be seen from the figure:</p><p>People who have become parents are significantly more likely to be attracted by discounts and then make purchases</p><p>Observe the correlation between &ldquo;numeric&rdquo; type attributes through the heat map. The darker the color, the stronger the correlation:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#Select all numerical columns from df and return the column names of these columns</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>select_dtypes</span><span class=p>(</span><span class=n>include</span><span class=o>=</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>number</span><span class=p>])</span><span class=o>.</span><span class=n>columns</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span><span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s1>&#39;Feature correlation&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>16</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=mf>1.05</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Plot the correlation coefficient matrix between numerical columns, showing the correlation through the color gradient of the heat map</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>heatmap</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>data</span><span class=p>]</span><span class=o>.</span><span class=n>corr</span><span class=p>(),</span> <span class=n>cmap</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/feature-correlation_hu_ee4fe174df102149.png alt=feature-correlation width=1026 height=397></p><p>It can be seen from the figure:</p><ul><li>&ldquo;Monthly official website visits&rdquo;, &ldquo;Total number of children&rdquo;, &ldquo;Whether they are a parent&rdquo; have little correlation with customer consumption amount</li><li>Income and product category will significantly affect customer consumption amount</li></ul><h2 id=4-data-processing>4. Data Processing</h2><p>Process the categorical features (i.e. non-numeric features) in the df, convert them into dummy variables (also known as dummy variables or indicator variables), and then create a new DataFrame (<code>df_final</code>) containing the original numerical features and the newly generated dummy variable:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#Select non-numeric features in df and return the corresponding column names</span>
</span></span><span class=line><span class=cl><span class=n>obj_feat</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>select_dtypes</span><span class=p>(</span><span class=n>exclude</span><span class=o>=</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>number</span><span class=p>])</span><span class=o>.</span><span class=n>columns</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#get_dummiesConvert non-numeric features into dummy variables</span>
</span></span><span class=line><span class=cl><span class=c1>#drop_first=True parameter means that for each feature, the dummy variable of the first category is dropped to avoid the dummy variable trap (i.e. complete multicollinearity)</span>
</span></span><span class=line><span class=cl><span class=c1>#concat function merges the original DataFrame (df) and the DataFrame (dummies) containing dummy variables along the column (axis=1) direction.</span>
</span></span><span class=line><span class=cl><span class=c1>#drop method removes the original non-numeric feature columns in df_final. inplace=True means modifying df_final in place without creating a new DataFrame.</span>
</span></span><span class=line><span class=cl><span class=c1>#df.shape gets the shape of df_final, that is, its number of rows and columns</span>
</span></span><span class=line><span class=cl><span class=n>dummies</span> <span class=o>=</span> <span class=n>get_dummies</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>obj_feat</span><span class=p>],</span> <span class=n>drop_first</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_final</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=n>df</span><span class=p>,</span> <span class=n>dummies</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_final</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=n>obj_feat</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_final</span><span class=o>.</span><span class=n>shape</span>
</span></span></code></pre></td></tr></table></div></div><p>The result is: (2212, 38)</p><p>Standardize the data using <code>StandardScaler</code> from <code>sklearn.preprocessing</code> and then convert the processed data back to Pandas DataFrame format:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#StandardScaler is a preprocessing class in the Scikit-learn library that scales features to a distribution with mean 0 and standard deviation 1</span>
</span></span><span class=line><span class=cl><span class=c1>#fit_transform calculates the mean and standard deviation of each feature, and then uses these parameters to standardize the data.</span>
</span></span><span class=line><span class=cl><span class=n>scaler</span> <span class=o>=</span> <span class=n>StandardScaler</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>scaled</span> <span class=o>=</span> <span class=n>scaler</span><span class=o>.</span><span class=n>fit_transform</span><span class=p>(</span><span class=n>df_final</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#DataFrame constructor converts the scaled array back to DataFrame format</span>
</span></span><span class=line><span class=cl><span class=c1>#In order to maintain the consistency of column names, use df_final.columns as the column names of the new DataFrame</span>
</span></span><span class=line><span class=cl><span class=c1>#So df_final_scaled is a new DataFrame that contains standardized data and retains the column names of the original DataFrame</span>
</span></span><span class=line><span class=cl><span class=n>df_final_scaled</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>scaled</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=n>df_final</span><span class=o>.</span><span class=n>columns</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_final_scaled</span><span class=o>.</span><span class=n>head</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/scaled-dataset_hu_e2d2c3c384f778fb.png alt=scaled-dataset width=1582 height=131></p><p>After normalization, the value of a data point represents the deviation of the original value from the mean, in units of standard deviation. For example, a processed value of 2 means that the original value of the data point is two standard deviations above the mean.</p><p>Use <code>LabelEncoder</code> to encode and convert non-numeric features in DataFrame (<code>df</code>) to facilitate subsequent data visualization:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>le</span> <span class=o>=</span> <span class=n>LabelEncoder</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Traverse all elements in obj_feat (except the last element) through a for loop</span>
</span></span><span class=line><span class=cl><span class=c1>#First fit the data in obj, find all the unique categories in the feature and their corresponding integer codes, and then convert these unique categories into integer codes</span>
</span></span><span class=line><span class=cl><span class=c1>#The current column (obj) in the original DataFrame is replaced with the trans column containing the converted integer encoding</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>obj</span> <span class=ow>in</span> <span class=n>obj_feat</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=n>trans</span> <span class=o>=</span> <span class=n>le</span><span class=o>.</span><span class=n>fit_transform</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>obj</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=n>obj</span><span class=p>]</span> <span class=o>=</span> <span class=n>trans</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=5-cluster-analysis>5. Cluster Analysis</h2><p>The &ldquo;Elbow method&rdquo; is used here for cluster analysis</p><h3 id=principle-of-elbow-method>Principle of &ldquo;Elbow method&rdquo;</h3><ol><li>Calculate SSE (sum of squared errors): For each value of k (i.e. number of clusters), we calculate the sum of squares of the Euclidean distances of all points to their assigned cluster centers, which is called SSE. As the value of k increases, the size of each cluster generally decreases, and therefore the distance of each point to its cluster center decreases, resulting in a decrease in SSE.</li><li>Find the &ldquo;elbow point&rdquo;: Ideally, we want to find a small k value while keeping the SSE relatively small. When we plot the SSE corresponding to different k values, as the k value increases, the decline rate of SSE will slow down, and the curve will show an &ldquo;elbow&rdquo; shape. This &ldquo;elbow point&rdquo; is often considered the optimal number of clusters, as adding more clusters after this point does not significantly improve model fit (i.e., decrease in SSE)</li></ol><p>Taking into account the impact of random initialization:</p><p>The KMeans algorithm randomly selects k clustering centers at the beginning, which may cause the algorithm results to be affected by the initial selection, making the final clustering result somewhat random. In order to obtain consistent results across multiple runs or different environments, we can set a random state.</p><p>Here, by setting <code>random_state=123</code>, we ensure that the initial random selection of cluster centers is the same every time we run KMeans, making the results reproducible.</p><h3 id=why-does-sse-decrease-as-k-increases>Why does SSE decrease as k increases?</h3><ol><li>Increase in cluster centers: When we increase the number of clusters k, it means that more cluster centers can be used to represent data points. As the number of cluster centers increases, each data point is more likely to be assigned to a cluster center that is closer to it, so the average distance of each point to its cluster center will decrease, resulting in lower SSE.</li><li>Decrease in cluster size: As the k value increases, the number of data points contained in each cluster usually decreases. Smaller clusters make data points within the cluster closer, reducing the distance between data points and their cluster centers, further reducing SSE.</li><li>Extreme cases: In extreme cases, if the value of k is equal to the total number of data points, then each data point is its own cluster center, and the SSE will be 0. But this situation has no actual clustering significance and just illustrates why SSE will continue to decrease as k increases.</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#Use the KMeans clustering algorithm and specify the maximum number of clusters to test as 10</span>
</span></span><span class=line><span class=cl><span class=c1>#KElbowVisualizer will evaluate k values from 1 to 10 to decide which k value is the best choice</span>
</span></span><span class=line><span class=cl><span class=c1>#Call the fit method to train the KMeans model</span>
</span></span><span class=line><span class=cl><span class=n>elbow</span> <span class=o>=</span> <span class=n>KElbowVisualizer</span><span class=p>(</span><span class=n>KMeans</span><span class=p>(</span><span class=n>random_state</span><span class=o>=</span><span class=mi>123</span><span class=p>),</span> <span class=n>k</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elbow</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>df_final_scaled</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elbow</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>The result of the run is a graph of different k values (number of clusters) and the corresponding SSE (sum of squared errors). The purpose of the elbow plot is to help us visually see how the SSE changes as the value of k increases. Ideally, SSE decreases as the k value increases, but the rate of decrease will slow down significantly at a certain point. This point is the so-called &ldquo;elbow point&rdquo; and is considered the optimal number of clusters.</p><p><img src=/posts/customer-profiling-and-segmentation/elbow-point-result_hu_910138221a64c86d.png alt=elbow-point-result width=772 height=202></p><p>As can be seen from the figure, the &ldquo;elbow point&rdquo; is k=5</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#Based on the results in the above figure, create a clustering object and set the number of clusters to 5. That is, the ultimate goal is to divide the data points into 8 clusters.</span>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>KMeans</span><span class=p>(</span><span class=n>n_clusters</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=mi>123</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#fit_predict uses the preprocessed and standardized data set to train (fit) the KMeans model and returns the cluster labels assigned to each data point. These labels are stored in the yhat variable</span>
</span></span><span class=line><span class=cl><span class=n>yhat</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>fit_predict</span><span class=p>(</span><span class=n>df_final_scaled</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Add the clustering results to the original DataFrame, allowing you to see which cluster each original data point belongs to</span>
</span></span><span class=line><span class=cl><span class=n>df</span><span class=p>[</span><span class=s1>&#39;Cluster&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>yhat</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#Plot the number of occurrences of each cluster label</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>countplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/cluster-distribution_hu_9828be887d015a59.png alt=cluster-distribution width=700 height=193></p><h2 id=6-customer-profiling-and-segmentation>6. Customer Profiling and Segmentation</h2><p>Analyze the relationship between income and total consumption, distinguish according to the clustering results, and draw scatter plots and violin plots:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>#constrained_layout=True ensures that the layout of the graphic is automatically adjusted to avoid overlap</span>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>axd</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplot_mosaic</span><span class=p>([[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>],[</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>]],</span> <span class=n>constrained_layout</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>14</span><span class=p>,</span><span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=o>.</span><span class=n>suptitle</span><span class=p>(</span><span class=s1>&#39;Income vs Total Spent&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>scatterplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Income&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Total_Spent&#39;</span><span class=p>,</span> <span class=n>hue</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axd</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>violinplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Total_Spent&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axd</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>violinplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Income&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axd</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/cluster-scatterplot-violinplot_hu_dfb8d48a8f46053d.png alt=cluster-scatterplot-violinplot width=1411 height=324></p><p>It can be seen from the figure:</p><p>Cluster 0: High Consumption & High Income</p><p>Cluster 1: Low Consumption & Low Income</p><p>Cluster 2: Average Consumption & Average Income</p><p>Cluster 3: Lowest consumption & lowest income</p><p>Cluster 4: Highest consumption & highest income</p><h3 id=what-do-you-think-of-the-violin-diagram>What do you think of the violin diagram?</h3><ol><li><strong>View Width</strong>: The shape of the violin plot can reveal the characteristics of the data distribution. For example, if the violin plot is particularly wide at one end, it indicates that the data points are denser around that value.</li><li><strong>Analysis Box Plot</strong>: The embedded box plot provides a five-number summary of the data, helping us understand the distribution range of the data and the location of the median.</li></ol><p>Plot the kernel density estimate (KDE) of &ldquo;age&rdquo; and &ldquo;total cost&rdquo;:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=n>sns</span><span class=o>.</span><span class=n>FacetGrid</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>col</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>g</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>,</span> <span class=s1>&#39;Age&#39;</span><span class=p>,</span> <span class=s1>&#39;Total_Spent&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;#95C8D8&#39;</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/age-spent-kdeplot_hu_a5f373f90477bbe2.png alt=age-spent-kdeplot width=1484 height=113></p><h3 id=how-to-analyze-the-kernel-density-estimation-chart>How to analyze the kernel density estimation chart</h3><p>The kernel density estimation plot (KDE plot) is a graph used to display the distribution of variables. It can be regarded as a smoothed version of the histogram. Through the KDE chart, we can intuitively understand the distribution of data, including the central tendency, dispersion and skewness of the data. Here are a few key points on how to interpret kernel density estimation plots:</p><ol><li><strong>Peaks</strong>: The peaks on the KDE chart represent the mode area in the data, that is, there are more data points near this value. There can be multiple peaks on a plot, indicating that the data distribution may be multimodal (i.e., there are multiple modes).</li><li><strong>Width</strong>: The width of the graph reflects the variability or dispersion of the data. A kernel density plot with a larger width indicates that the data points are more dispersed; conversely, a plot with a narrower width indicates that the data points are more concentrated.</li><li><strong>Skewness</strong>: If the KDE plot is not completely symmetrical, the data distribution may be skewed. If the graph extends longer to the right, the data is positively skewed (right-skewed), that is, more data values are to the left of the mean; if the graph extends longer to the left, the data is negatively skewed (left-skewed), That is, more data values are to the right of the mean.</li><li><strong>Tails</strong>: The tail of the KDE plot can tell us the tail behavior of the data distribution, such as whether there is a long tail or extreme values. A long tail is when one end of the graph extends very far, indicating that there are some extreme high or low values.</li><li><strong>Overlay Plot</strong>: Sometimes, researchers will draw multiple KDE plots on the same graph to compare the data distribution of different subsets. At this time, you can understand the distribution differences between different subsets by observing which areas overlap more and the shape differences of each graph.</li><li><strong>Kernel density estimation and actual data</strong>: It should be noted that the kernel density estimation graph represents an estimate of the data distribution, not the actual data distribution. Therefore, it is useful for revealing overall trends in the data, but may not be suitable for precise statistical testing.</li></ol><p>Plot the kernel density estimates of &ldquo;parent or not&rdquo; and &ldquo;total spent&rdquo;:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=n>sns</span><span class=o>.</span><span class=n>FacetGrid</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>col</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>g</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>,</span> <span class=s1>&#39;Is_Parent&#39;</span><span class=p>,</span> <span class=s1>&#39;Total_Spent&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;#95C8D8&#39;</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=mf>0.6</span><span class=p>,</span><span class=mi>3900</span><span class=p>,</span> <span class=s1>&#39;0: Non Parent</span><span class=se>\n</span><span class=s1>1: Parent&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>12</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/isparent-spent-kdeplot_hu_d7cc5ff934d02d53.png alt=isparent-spent-kdeplot width=1484 height=138></p><p>Plot the kernel density estimates of &ldquo;number of children&rdquo; and &ldquo;total spent&rdquo;:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=n>sns</span><span class=o>.</span><span class=n>FacetGrid</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>col</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>g</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>,</span> <span class=s1>&#39;Kidhome&#39;</span><span class=p>,</span> <span class=s1>&#39;Total_Spent&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;#95C8D8&#39;</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/kidhome-spent-kdeplot_hu_44f0e5aebbde0f00.png alt=kidhome-spent-kdeplot width=1484 height=113></p><p>Plot the kernel density estimates of &ldquo;number of teenagers&rdquo; and &ldquo;total spent&rdquo;:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=n>sns</span><span class=o>.</span><span class=n>FacetGrid</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>col</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>g</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>,</span> <span class=s1>&#39;Teenhome&#39;</span><span class=p>,</span> <span class=s1>&#39;Total_Spent&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;#95C8D8&#39;</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/teenhome-spent-kdeplot_hu_9c5054e023532708.png alt=teenhome-spent-kdeplot width=1484 height=113></p><p>Plot the kernel density estimates of &ldquo;total children&rdquo; and &ldquo;total spent&rdquo;:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=n>sns</span><span class=o>.</span><span class=n>FacetGrid</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>col</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>g</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>,</span> <span class=s1>&#39;Total_Children&#39;</span><span class=p>,</span> <span class=s1>&#39;Total_Spent&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;#95C8D8&#39;</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/totalchildren-spent-kdeplot_hu_aea1701869e4f33a.png alt=totalchildren-spent-kdeplot width=1484 height=113></p><p>Plot the kernel density estimates of &ldquo;relationship status&rdquo; and &ldquo;total spent&rdquo;:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=n>sns</span><span class=o>.</span><span class=n>FacetGrid</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>col</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>g</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=n>sns</span><span class=o>.</span><span class=n>kdeplot</span><span class=p>,</span> <span class=s1>&#39;Living_With&#39;</span><span class=p>,</span> <span class=s1>&#39;Total_Spent&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;#95C8D8&#39;</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=mf>0.7</span><span class=p>,</span><span class=mi>3900</span><span class=p>,</span> <span class=s1>&#39;0: Alone</span><span class=se>\n</span><span class=s1>1: Partner&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>12</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/livingwith-spent-kdeplot_hu_51e50e9c0e1ed4c8.png alt=livingwith-spent-kdeplot width=1484 height=138></p><p>Draw a scatter plot of &ldquo;education status&rdquo; and &ldquo;total spent&rdquo;:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>g</span> <span class=o>=</span> <span class=n>sns</span><span class=o>.</span><span class=n>FacetGrid</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>col</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>g</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=n>sns</span><span class=o>.</span><span class=n>scatterplot</span><span class=p>,</span> <span class=s1>&#39;Education&#39;</span><span class=p>,</span> <span class=s1>&#39;Total_Spent&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;#95C8D8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=mf>0.6</span><span class=p>,</span><span class=mi>3400</span><span class=p>,</span> <span class=s1>&#39;0: Graduate</span><span class=se>\n</span><span class=s1>1: Postgraduate</span><span class=se>\n</span><span class=s1>2: Undergraduate&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>12</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/education-spent-scatterplot_hu_4807a0a7b77c4c3d.png alt=education-spent-scatterplot width=1484 height=146></p><h3 id=how-to-analyze-a-scatter-plot>How to analyze a scatter plot?</h3><ol><li>Correlation</li></ol><p>Positive correlation: If an increase in one variable is accompanied by an increase in the other variable, then there is a positive correlation between the two variables. In a scatter plot, this appears as a general trend of the set of points from lower left to upper right.
Negative correlation: If an increase in one variable is accompanied by a decrease in the other variable, then there is a negative correlation between the two variables. In a scatter plot, this appears as a general trend of the set of points from upper left to lower right.
No correlation: If there is no obvious linear relationship between the two variables, the point set is relatively evenly distributed on the graph and there is no obvious trend.</p><ol start=2><li>Clusters</li></ol><p>The points on a scatter plot sometimes form one or more clusters, indicating the presence of distinct subgroups in the data. These clusters may represent different categories, groups, or data points with similar characteristics.</p><ol start=3><li>Outliers</li></ol><p>In a scatter plot, points that are far away from other data points are called outliers. These points may represent data entry errors, measurement errors, or actual data distribution properties.</p><ol start=4><li>Trend Line</li></ol><p>Sometimes a trend line (such as a linear regression line) is added to a scatter plot to more clearly show the main trend between variables. The slope and direction of a trend line provide a visual representation of the relationship between variables.</p><ol start=5><li>Distribution density</li></ol><p>In some scatter plots, the density of points reflects the concentration of data in that area. Areas with denser points indicate that there are more data points there.</p><p>Plot a bar chart between &ldquo;customer category&rdquo; and &ldquo;customer last purchase time&rdquo;:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>9</span><span class=p>,</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s2>&#34;Average Number of Days Since Customer&#39;s Last Purchase</span><span class=se>\n</span><span class=s2>by Clusters&#34;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Recency&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/cluster-recency-barplot_hu_acaed259e92c83f.png alt=cluster-recency-barplot width=762 height=166></p><p>Observe the average consumption of different customer groups (Cluster) in different product categories (such as wine, fruit, meat, etc.):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>axes</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>16</span><span class=p>,</span><span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=o>.</span><span class=n>suptitle</span><span class=p>(</span><span class=s2>&#34;Customer&#39;s Average Spent on Products</span><span class=se>\n</span><span class=s2>by Clusters&#34;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span> <span class=o>=</span> <span class=n>axes</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Wines&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Wines&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Fruits&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Fruits&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Meats&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Meats&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Fish&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Fish&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Sweets&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Sweets&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Golds&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>5</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Gold&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Adjust the layout of the subfigures to ensure there is enough space between subfigures and that the titles and axis labels do not overlap.</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>tight_layout</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/cluster-products-barplot_hu_9dd77186e2e16297.png alt=cluster-products-barplot width=1584 height=314></p><p>Observe the average number of purchases by different customer groups in different sales channels:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>axes</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>16</span><span class=p>,</span><span class=mi>5</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=o>.</span><span class=n>suptitle</span><span class=p>(</span><span class=s2>&#34;Average Number of Purchases Made</span><span class=se>\n</span><span class=s2>Through Different Methods by Clusters&#34;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span> <span class=o>=</span> <span class=n>axes</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>custom_ylim</span> <span class=o>=</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>setp</span><span class=p>(</span><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>ylim</span><span class=o>=</span><span class=n>custom_ylim</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>setp</span><span class=p>(</span><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>ylim</span><span class=o>=</span><span class=n>custom_ylim</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Web&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Web&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Catalog&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Catalog&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Store&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Store&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>tight_layout</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/cluster-methods-barplot_hu_485c447fc4de34e.png alt=cluster-methods-barplot width=1584 height=196></p><p>Observe the average number of purchases by different customer groups in different marketing campaigns:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>axes</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>16</span><span class=p>,</span><span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=o>.</span><span class=n>suptitle</span><span class=p>(</span><span class=s2>&#34;Average Number of Purchases Made</span><span class=se>\n</span><span class=s2>Through Different Campaigns by Clusters&#34;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span> <span class=o>=</span> <span class=n>axes</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;AcceptedCmp1&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Campaign 1&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;AcceptedCmp2&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Campaign 2&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;AcceptedCmp3&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Campaign 3&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;AcceptedCmp4&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Campaign 4&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;AcceptedCmp5&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Campaign 5&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;AcceptedCmp6&#39;</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axes</span><span class=p>[</span><span class=mi>5</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Campaign 6&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>tight_layout</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/cluster-campaigns-barplot_hu_90ab598fe22c4b66.png alt=cluster-campaigns-barplot width=1584 height=314></p><p>Observe how different customer groups use discounts for consumption:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>9</span><span class=p>,</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s1>&#39;Average Number of Purchases Made with a Discount</span><span class=se>\n</span><span class=s1>by Clusters&#39;</span><span class=p>,</span> <span class=n>weight</span><span class=o>=</span><span class=s1>&#39;bold&#39;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sns</span><span class=o>.</span><span class=n>barplot</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>df</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Cluster&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;NumDealsPurchases&#39;</span><span class=p>,</span> <span class=n>ci</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>palette</span><span class=o>=</span><span class=s1>&#39;Blues&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/posts/customer-profiling-and-segmentation/cluster-discounts-barplot_hu_d97b2db3974eaec2.png alt=cluster-discounts-barplot width=766 height=166></p><p>Based on the above charts, we can summarize the following five types of user portraits:</p><p>Cluster 0:</p><ul><li>High consumption & high income</li><li>Across all ages</li><li>Most have never become parents</li><li>Become a parent with 1 teenager at home</li></ul><p>Cluster 1:</p><ul><li>Low consumption & low income</li><li>Across all ages</li><li>Most have become parents</li><li>Maximum 3 children</li></ul><p>Cluster 2:</p><ul><li>Average consumption & average income</li><li>relatively older</li><li>Almost all of them are parents, except for a few</li><li>Maximum 3 children, mainly teenagers</li><li>Passionate about purchasing with discounts</li></ul><p>Cluster 3:</p><ul><li>Lowest consumption & lowest income</li><li>Relatively younger</li><li>Maximum 2 children, mainly children</li></ul><p>Cluster 4:</p><ul><li>Highest consumption & highest income</li><li>Across all ages</li><li>Most have never become parents</li><li>Actively participated in 6 marketing campaigns</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2024-04-07</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://chloevolution.com/posts/customer-profiling-and-segmentation/ data-title="Customer Profiling & Segmentation with Python (Source code)" data-hashtags=Python><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://chloevolution.com/posts/customer-profiling-and-segmentation/ data-hashtag=Python><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://chloevolution.com/posts/customer-profiling-and-segmentation/ data-title="Customer Profiling & Segmentation with Python (Source code)"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://chloevolution.com/posts/customer-profiling-and-segmentation/ data-title="Customer Profiling & Segmentation with Python (Source code)"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://chloevolution.com/posts/customer-profiling-and-segmentation/ data-title="Customer Profiling & Segmentation with Python (Source code)"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/python/>Python</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/best-mind-mapping-software-for-mac/ class=prev rel=prev title="14 Best Mind Mapping Software for Mac in 2025 (Features, Pros, Cons, Pricing)"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>14 Best Mind Mapping Software for Mac in 2025 (Features, Pros, Cons, Pricing)</a>
<a href=/posts/how-to-read-a-zst-file-python/ class=next rel=next title="How to Read a ZST File via Python">How to Read a ZST File via Python<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><section><span id=busuanzi_container_value_site_pv><i class="far fa-eye fa-fw"></i>
<span id=busuanzi_value_site_pv></span>
</span>&nbsp;|&nbsp;
<span id=busuanzi_container_value_site_uv><i class="fa fa-user"></i>
<span id=busuanzi_value_site_uv></span></span></section></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/valine@1.5.0/dist/Valine.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{valine:{appId:"QGzwQXOqs5JOhN4RGPOkR2mR-MdYXbMMI",appKey:"WBmoGyJtbqUswvfLh6L8iEBr",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!1,highlight:!0,lang:"en",pageSize:10,placeholder:"Your comment ...",recordIP:!0,serverURLs:"https://leancloud.hugoloveit.com",visitor:!0}},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"PASDMWALPK",algoliaIndex:"index.en",algoliaSearchKey:"b42948e51daaa93df92381c8e2ac0f93",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.d7121d72cd85153ec9d35a888cee3eb28c2700ca763f649a538f6c772d750021.js integrity="sha256-1xIdcs2FFT7J01qIjO4+sownAMp2P2SaU49sdy11ACE="></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js></script><script type=text/javascript src=/js/custom.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J96VH8CX0X",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-J96VH8CX0X" async></script></body></html>